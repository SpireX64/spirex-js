[⮜ 00 – Установка](./00_INSTALL.md) ● [Индекс](./README.md) ● [02 – Процесс ⮞](./02_PROCESS.md) 

# 1. Создание и настройка задач.

Процесс инициализации состоит из набора определенных задач.
Задачи могут быть синхронными или асинхронными, а также зависеть от других задач.

В этом разделе мы рассмотрим, как создавать
и управлять задачами инициализации.

- [1.1 - Создание простой задачи](#11-создание-простой-задачи)
- [1.2 - Создание асинхронной задачи.](#12-создание-асинхронной-задачи)
- [1.3 - Имя задачи](#13-имя-задачи)
  - [1.3.1 - Явное определение имени](#131-явное-определение-имени)
  - [1.3.2 - Неявное определение имени](#132-неявное-определение-имени)
- [1.4 - Зависимости задач](#14-зависимости-задач)
  - [1.4.1 - Строгая зависимость](#141-строгая-зависимость)
  - [1.4.2 - Слабая зависимость](#142-слабая-зависимость)
- [1.5 - Необязательная задача](#15-необязательная-задача)
- [1.6 - Запуск задач вне процесса](#16-запуск-задач-вне-процесса)

## 1.1. Создание простой задачи.
Чтобы создать задачу, используйте функцию `AppBoot.task(...)`. 
И передайте ей функцию, которая определяет, что эта задача должна делать. 
Это позволяет вам инкапсулировать логику инициализации в отдельных задачах.

```ts
const myTask = AppBoot.task(() => {
    // Код, который задача должна выполнить
    console.log('My boot task');
});
```
Эта задача выполнится сразу после запуска процесса инициализации
и выведет в консоль сообщение "My boot task".


## 1.2. Создание асинхронной задачи.
В прошлом примере была передана синхронная функция.
Однако процесс инициализации часто требует асинхронных вызовов,
например, отправку запросов на сервер или чтение файлов.
Для этого в задачу можно передать асинхронную функцию:

```ts
const myAsyncTask = AppBoot.task(async () => {
    const config = await fetchConfigutaionAsync();
    console.log('Configuration', config);
});
```
Эта задача будет ждать завершения асинхронного вызова fetchConfigurationAsync.


## 1.3. Имя задачи.
Очень полезно иметь идентификатор задачи, чтобы отличать её от других, например, для логирования.

У задач инициализации таким идентификатором является имя, однако по умолчанию его у них нет.
Если попытаться его распечатать, будет возвращена пустая строка.

```ts
const myTask = AppBoot.task(() => {});
console.log(myTask.name); // ""
```

Есть два способа задать имя задачи: явное и неявное.

### 1.3.1. Явное определение имени.
Первый способ предполагает явную передачу имени
в фабрику перед аргументом функции:

```ts
const task = AppBoot.task("Init Config", () => {});

console.log(task.name); // "Init Config"
```

### 1.3.2. Неявное определение имени.
Неявный способ позволяет использовать
имя функции в качестве имени задачи:

```ts
function logInitInfo() {}
const task = AppBoot.task(logInitInfo);

console.log(task.name) // "logInitInfo"
```

## 1.4. Зависимости задач.
Задачи могут зависеть от выполнения других задач.
Определение зависимостей гарантирует,
что задача запустится только после того, 
как все зависимости были выполнены.
Зависимости указываются в виде массива после функции.


### 1.4.1. Строгая зависимость.
Слабая зависимость задает только порядок выполнения. Если слабая зависимость задачи не выполнена или завершилась с ошибкой, то данная задача все еще может быть выполнена.

```ts
const taskA = AppBoot.task(() => {});

const taskB = AppBoot.task(() => {
    // do something...
}, [ taskA ]); // depends on 'taskA'

const taskC = AppBoot.task(() => {
    // do something else...
}, [ taskA, taskB ]); // depends on 'taskA' and 'taskB'
```

### 1.4.2. Слабая зависимость.
Слабая зависимость задает только порядок выполнения.
Если слабая зависимость задачи не выполнена или завершилась с ошибкой,
то данная задача все еще может быть выполнена.

```ts
const taskA = AppBoot.task(() => {});

const taskB = AppBoot.task(() => {
    // do something
}, [
    // Слабая зависимость от 'taskA'
    { task: taskA, weak: true },
]);
```

### 1.5. Необязательная задача.
По умолчанию все задачи обязательные.
Если хоть одна обязательная задача не будет выполнена,
процесс инициализации завершится с ошибкой. 

Однако такое поведение может не подойти в определенных случаях,
например, когда у приложения нет доступа к сети,
и запросы на сервер завершаются ошибкой.

Передача значения true последним параметром
отмечает задачу как необязательную.

```ts
const myOptionalTask = AppBoot.task(() => {
    // логика задачи
}, null, true); // Не имеет зависимостей, необязательная
```

- Если зависимая задача обязательная - процесс упадет с ошибкой.
- Если зависимая задача необязательная - она будет пропущена.

### 1.6. Запуск задач вне процесса.
Задачи можно выполнить вне процесса, используя функцию `run`.
При таком запуске, зависимости задачи игнорируются.

```ts
const myTask = AppBoot.task(() => {
    console.log('Hello from myTask')
});

myTask.run(); // "Hello from myTask"
```

Такой способ запуска будет полезен в тестировании задачи,
но не рекомендуется для использования в реальном приложении.

[⮜ 00 – Установка](./00_INSTALL.md) ● [Индекс](./README.md) ● [02 – Процесс ⮞](./02_PROCESS.md) 
